***REMOVED***use strict***REMOVED***;

const noop = () => {}; // eslint-disable-line no-empty-function
const methods = [***REMOVED***get***REMOVED***, ***REMOVED***post***REMOVED***, ***REMOVED***delete***REMOVED***, ***REMOVED***patch***REMOVED***, ***REMOVED***put***REMOVED***];
const reflectors = [
  ***REMOVED***toString***REMOVED***,
  ***REMOVED***valueOf***REMOVED***,
  ***REMOVED***inspect***REMOVED***,
  ***REMOVED***constructor***REMOVED***,
  Symbol.toPrimitive,
  Symbol.for(***REMOVED***nodejs.util.inspect.custom***REMOVED***),
];

function buildRoute(manager) {
  const route = [***REMOVED******REMOVED***];
  const handler = {
    get(target, name) {
      if (reflectors.includes(name)) return () => route.join(***REMOVED***/***REMOVED***);
      if (methods.includes(name)) {
        const routeBucket = [];
        for (let i = 0; i < route.length; i++) {
          // Reactions routes and sub-routes all share the same bucket
          if (route[i - 1] === ***REMOVED***reactions***REMOVED***) break;
          // Literal IDs should only be taken account if they are the Major ID (the Channel/Guild ID)
          if (/\d{16,19}/g.test(route[i]) && !/channels|guilds/.test(route[i - 1])) routeBucket.push(***REMOVED***:id***REMOVED***);
          // All other parts of the route should be considered as part of the bucket identifier
          else routeBucket.push(route[i]);
        }
        return options =>
          manager.request(
            name,
            route.join(***REMOVED***/***REMOVED***),
            Object.assign(
              {
                versioned: manager.versioned,
                route: routeBucket.join(***REMOVED***/***REMOVED***),
              },
              options,
            ),
          );
      }
      route.push(name);
      return new Proxy(noop, handler);
    },
    apply(target, _, args) {
      route.push(...args.filter(x => x != null)); // eslint-disable-line eqeqeq
      return new Proxy(noop, handler);
    },
  };
  return new Proxy(noop, handler);
}

module.exports = buildRoute;
